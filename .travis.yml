---
git:
  depth: 1
language: node_js
node_js:
  - '4.4'
  - '6.2'
addons:
  firefox: "latest"
env:
  global:
    - SAUCE_LABS=false PARSER=false OPTIONS=""
  matrix:
    - PARSER="traceur"
    - PARSER="babel"
matrix:
  include:
    - node_js: "4.4"
      env: SAUCE_LABS=true PARSER="traceur"
    - node_js: "4.4"
      env: SAUCE_LABS=true PARSER="babel"
    # Native iterator tests
    - node_js: "4.4"
      env: SAUCE_LABS=true PARSER="traceur" OPTIONS="--native-iterator"
    - node_js: "4.4"
      env: SAUCE_LABS=true PARSER="babel" OPTIONS="--native-iterator"
    # Map polyfill tests
    - node_js: "4.4"
      env: SAUCE_LABS=true PARSER="babel" OPTIONS="--force-map-polyfill"
    - node_js: "4.4"
      env: SAUCE_LABS=true PARSER="babel" OPTIONS="--native-iterator --force-map-polyfill"
before_install:
#  - export CHROME_BIN=chromium-browser
  - export DISPLAY=:99.0
  - sh -e /etc/init.d/xvfb start
  - npm update -g
  - npm install -g karma-cli grunt-cli
before_script:
  - grunt
script:
  - npm run test:node
  - npm run test:browser-$PARSER
  - "[ $SAUCE_LABS == false ] || npm run test:browser-$PARSER -- --saucelabs $OPTIONS"
