/*! es6-module-loader - v0.2.0 - 6/30/2013
* https://github.com/addyosmani/es6-module-loader
* Copyright (c) 2013 Guy Bedford, Luke Hoban, Addy Osmani; Licensed MIT */
(function(global){function Loader(e){var t=function(){};t.prototype=e.global||window,this._intrinsics=new t;var n={},r=["addEventListener","removeEventListener","getComputedStyle","setTimeout","setInterval"];for(var i=0;i<r.length;i++)(function(e){n[e]=function(){return window[e].apply(window,arguments)}})(r[i]);this.defineBuiltins(n),this.defineBuiltins(e.intrinsics&&e.intrinsics._intrinsics||{}),t=function(){},t.prototype=this._intrinsics,this._global=new t,Object.defineProperty(this._global,"window",{value:this._global}),this._strict=!!e.strict,this.normalize=e.normalize||global.System.normalize,this.resolve=e.resolve||global.System.resolve,this.fetch=e.fetch||global.System.fetch,this.translate=e.translate||global.System.translate,this.link=e.link||global.System.link,this._mios={},this._mloads={},this._sloads={}}function Module(e){if(e===null)throw new TypeError("Expected object");var t=Object(e);if(t instanceof Module)return t;var n=Object.create(null);for(var r in t)(function(e){Object.defineProperty(n,e,{configurable:!1,enumerable:!0,get:function(){return t[e]}})})(r);return n}Object.defineProperty(Loader.prototype,"global",{configurable:!0,enumerable:!0,get:function(){return this._global}}),Loader.prototype.load=function(e,t,n){var r=this;if(e instanceof Array){var i=0;for(var s=0;s<e.length;s++)(function(s){r.load(e[s],function(){i++,i==e.length&&t&&t()},n)})(s);return}if(this._mios[e]){t(this._mios[e]);return}if(this._sloads[e]){this._sloads[e].push({callback:t,errback:n});return}this._sloads[e]=[{callback:t,errback:n}];var o=function(){for(var t=0;t<r._sloads[e].length;t++)r._sloads[e][t].callback&&r._sloads[e][t].callback();delete r._sloads[e]},u=function(){for(var t=0;t<r._sloads[e].length;t++)r._sloads[e][t].errback&&r._sloads[e][t].errback();delete r._sloads[e]};this.fetch(e,function(t){var n={address:e,type:"script"};t=r.translate(t,n),r._linkExecute(e,t,n,o,u,!0)},u)},Loader.prototype.import=function(e,t,n,r){var i=this;if(e instanceof Array){var s=[],o=0,i=this;for(var u=0;u<e.length;u++)(function(r){i.import(e[r],function(n){s[r]=n,o++,o==e.length&&t&&t.apply(null,s)},n)})(u);return}e=this.normalize(e,r);var a={referer:r,metadata:typeof e=="object"?e.metadata:null};typeof e!="string"&&(e=e.normalized);if(this._mios[e])return t(this._mios[e]);if(this._mloads[e]){this._mloads[e].push({callback:t,errback:n});return}this._mloads[e]=[{callback:t,errback:n}];var f=function(t){i._mios[e]=t;for(var n=0;n<i._mloads[e].length;n++)i._mloads[e][n].callback&&i._mloads[e][n].callback(t);delete i._mloads[e]},l=function(){if(n){if(n.called)return;n.called=!0}for(var t=0;t<i._mloads[e].length;t++)i._mloads[e][t].errback&&i._mloads[e][t].errback();delete i._mloads[e]},c=this.resolve(e,a);typeof c!="string"&&(c=c.address),a.normalized=e,this.fetch(c,function(t){a.address=c,a.type="module",t=i.translate(t,a),i._linkExecute(e,t,a,f,l)},l,a)};var evalCnt=0;Loader.prototype._linkExecute=function(e,t,n,r,i,s){e||(e="__eval"+evalCnt++);var o=this.link(t,n);if(o instanceof Module&&!s)return r(o);var u=this;ES6Parser.loadEsprima(e,t,function(){var a,f;typeof o=="object"&&!s?(a=o.imports,f=o.execute):a=ES6Parser.parseImports(e,t);if(i.called)return;var l=t,c={};f=f||function(){var t;try{t=ES6Parser.parseEval(l,u,e,c,n.address)}catch(r){return i(r)}if(e&&!s)return new Module(t||{})};if(!a.length)return r(f.call(u));var h=[],p=0;for(var d=0;d<a.length;d++)(function(t){var s={name:e,address:n.address},o=u.normalize(a[t],s);typeof o=="object"&&(o=o.normalized),a[t]=c[a[t]]=o,u.import(a[t],function(e){p++,h[t]=e,p==a.length&&r(f.apply(u,h))},i,s)})(d)},i)},Loader.prototype.eval=function(e){ES6Parser.parseEval(e,this)},Loader.prototype.evalAsync=function(e,t,n){this._linkExecute(null,e,{},t||function(){},n||function(){},!0)},Loader.prototype.get=function(e){return this._mios[e]||null},Loader.prototype.set=function(e,t){this._mios[e]=Module(t)},Loader.prototype.has=function(e){return!!this._mios[e]},Loader.prototype.delete=function(e){delete this._mios[e]},Loader.prototype.defineBuiltins=function(e){for(var t in e)e.hasOwnProperty(t)&&(this._intrinsics[t]=e[t])};var absUrlRegEx=/^\/|([^\:\/]*:)/,isUrl=function(e){return e.substr(e.length-3,3)==".js"||e.match(absUrlRegEx)},defaultSystemLoader=new Loader({global:window,strict:!1,normalize:function(e,t){if(isUrl(e))return e;var n=t&&t.name;if(e.substr(0,2)=="./"){var r=n.split("/");return r.length?(r.pop(),r.push(e.substr(2)),r.join("/")):e.substr(2)}if(e.substr(0,3)=="../"){var r=n.split("/");if(!r.length)throw"Path below baseUrl";return r.pop(),this.normalize(e.substr(3),{name:r.join("/")})}return e},resolve:function(e,t){for(var n in this.ondemandTable)if(this.ondemandTable[n].indexOf(e)!=-1)return e;return isUrl(e)?e:this.baseURL+(this.baseURL.substr(this.baseURL.length-1,1)!="/"?"/":"")+e+(e.split("/").pop().indexOf(".")==-1?".js":"")},fetch:function(e,t,n,r){var i=new XMLHttpRequest;i.onreadystatechange=function(){i.readyState===4&&(i.status===200||i.status==0&&i.responseText?t(i.responseText):n(i.statusText))},i.open("GET",e,!0),i.send(null)},translate:function(e,t){return e},link:function(e,t){}});defaultSystemLoader.baseURL=document.URL.substring(0,window.location.href.lastIndexOf("/")+1),defaultSystemLoader.ondemandTable={},defaultSystemLoader.ondemand=function(e){for(var t in e)this.ondemandTable[t]=this.ondemandTable[t]||[],e[t]instanceof Array?this.ondemandTable[t]=this.ondemandTable[t].concat(e[t]):this.ondemandTable[t].push(e[t])};var scripts=document.getElementsByTagName("script"),curPath=scripts[scripts.length-1].src,basePath=curPath.substr(0,curPath.lastIndexOf("/")+1),ES6Parser={traverse:function(e,t){var n,r;if(t(e)===!1)return;for(n in e)r=e[n],typeof r=="object"&&r!==null&&this.traverse(r,t)},importRegEx:/^\s*import\s+./m,exportRegEx:/^\s*export\s+(\{|\*|var|class|function|default)/m,moduleRegEx:/^\s*module\s+("[^"]+"|'[^']+')\s*\{/m,checkModuleSyntax:function(e,t){if(e==null||this.parseNames[e]===undefined)this.parseNames[e]=t&&!!(t.match(this.importRegEx)||t.match(this.exportRegEx)||t.match(this.moduleRegEx));return this.parseNames[e]},loadEsprima:function(e,t,n,r){if(!this.checkModuleSyntax(e,t))return n();var i=this;System.load(basePath+"esprima-es6.min.js",function(){i.esprima=System.global.esprima,n()})},parseNames:{},treeCache:{},parseImports:function(e,t){if(!this.checkModuleSyntax(e,t))return[];var n=this.treeCache[e]||(this.treeCache[e]=this.esprima.parse(t,{range:!0})),r=[];return this.traverse(n,function(e){if(e.type=="ImportDeclaration"){var t;e.from.type=="Literal"?t=e.from.value:e.from.type=="Path"&&(t=e.from.body[0].name),r.push(t)}else e.type=="ExportDeclaration"&&e.specifiers&&e.specifiers[0]&&e.specifiers[0].from&&(e.specifiers[0].from.body=="Path"?r.push(e.specifiers[0].from.body[0].name):r.push(e.specifiers[0].from.value))}),r},addPolyfill:function(e,t,n){this.loadEsprima(null,null,t,n),this.polyfills.push(e)},polyfills:[],applyPolyfill:function(e,t){for(var n=0;n<this.polyfills.length;n++)this.polyfills[n](e,t)},parseEval:function(source,loader,name,normalizeMap,sourceURL){if(!this.checkModuleSyntax(name,source)){var __Loader=loader;eval("(function(window) { with(__Loader.global) { "+(loader._strict?'"use strict";\n':"")+source+" } }).call(__Loader.global, __Loader.global); "+(sourceURL?"\n//# sourceURL="+sourceURL:""));return}var tree=this.treeCache[name]||this.esprima.parse(source,{range:!0});normalizeMap=normalizeMap||{};var tSource=new SourceModifier(source),self=this;this.traverse(tree,function(e){if(e.type=="ImportDeclaration")if(e.from.type=="Literal"&&e.specifiers[0].type!="ImportSpecifier")tSource.replace(e.range[0],e.range[1],"var "+e.as.name+" = __Loader.get('"+(normalizeMap[e.from.value]||e.from.value)+"');");else{var t;e.from.body?t=e.from.body[0].name:e.from.type=="Literal"&&(t=e.from.value),t=normalizeMap[t]||t;if(e.specifiers[0].type=="Glob")tSource.replace(e.range[0],e.range[1],"var __module = __Loader.get('"+t+"');"+"for (var m in __module)"+"  __global[m] = __module[m];");else if(e.specifiers[0].type=="ImportSpecifier"){var n="var __module = __Loader.get('"+t+"');";for(var r=0;r<e.specifiers.length;r++)n+="var "+e.specifiers[r].id.name+" = "+"__module['"+(e.specifiers[r].from?e.specifiers[r].from.body[0].name:e.specifiers[r].id.name)+"'];";tSource.replace(e.range[0],e.range[1],n)}}else if(e.type=="AssignmentExpression"&&e.left.name&&e.left.name=="exports")tSource.replace(e.left.range[0],e.left.range[1],"__exports");else if(e.type=="ExportDeclaration"){var i,s;e.specifiers&&e.specifiers[0]&&e.specifiers[0].from&&(e.specifiers[0].from.body=="Path"?i=e.specifiers[0].from.body[0].name:i=e.specifiers[0].from.value);if(!e.declaration&&e.specifiers){if(e.specifiers[0].id.type=="Glob")s=!0;else if(e.specifiers[0].type=="ExportSpecifierSet"){s={};for(var r=0;r<e.specifiers[0].specifiers.length;r++)e.specifiers[0].specifiers[r].from?s[e.specifiers[0].specifiers[r].id.name]=tSource.getRange.apply(tSource,e.specifiers[0].specifiers[r].from.range):s[e.specifiers[0].specifiers[r].id.name]=e.specifiers[0].specifiers[r].id.name}else if(e.specifiers[0].type="ExportSpecifier"){s={};for(var r=0;r<e.specifiers.length;r++)s[e.specifiers[r].id.name]=e.specifiers[r].id.name}}else if(e.declaration.type=="VariableDeclaration")s=e.declaration.declarations[0].id.name;else if(e.declaration.type=="FunctionDeclaration")s=e.declaration.id.name;else if(e.declaration.type=="ModuleDeclaration"||e.declaration.type=="ClassDeclaration")s=e.declaration.declarations[0].id.name;if(i){i=normalize(i);if(s===!0)tSource.replace(e.range[0],e.range[1],"__exports = __Loader.get('"+i+"');");else{var n="";for(var o in s)n+="__exports['"+o+"'] = __Loader.get('"+i+"')['"+s[o]+"'];";tSource.replace(e.range[0],e.range[1],n)}}else if(typeof s=="object"){var n="";for(var o in s)n+="__exports['"+o+"'] = "+s[o]+"; ";tSource.replace(e.range[0],e.range[1],n)}else typeof s=="string"&&(e.declaration.declarations?tSource.replace(e.range[0],e.declaration.declarations[0].id.range[0]-1,"__exports['"+s+"'] = "):e.declaration.type=="FunctionDeclaration"?tSource.replace(e.range[0],e.declaration.range[0]-1,"__exports['"+s+"'] = "):tSource.replace(e.range[0],e.declaration.id.range[0]-1,"__exports['"+s+"'] = "))}else if(e.type=="ModuleDeclaration"){var t=e.id.name;e.body.type=="BlockStatement"&&(tSource.replace(e.range[0],e.body.range[0]+1,"(function() { var __exports = {}; "),tSource.replace(e.body.range[1],e.range[1]," __Loader.set('"+t+"', new Module(__exports)); })();"))}else self.polyfills.length&&self.applyPolyfill(e,tSource)}),delete this.treeCache[name];var __Loader=loader,__exports={},evalSource="(function(window) { with(__Loader.global) { "+(loader._strict?'"use strict";\n':"")+tSource.toString()+" } }).call(__Loader.global, __Loader.global);"+(sourceURL?"\n//# sourceURL="+sourceURL:"");return eval(evalSource),__exports}},SourceModifier=function(e){this.source=e,this.rangeOps=[]};SourceModifier.prototype={mapIndex:function(e){for(var t=0;t<this.rangeOps.length;t++){var n=this.rangeOps[t];if(n.start>=e)continue;if(n.end<=e){e+=n.diff;continue}throw"Source location "+e+" has already been transformed!"}return e},replace:function(e,t,n){var r=n.length-(t-e+1);e=this.mapIndex(e),t=this.mapIndex(t),this.source=this.source.substr(0,e)+n+this.source.substr(t+1),this.rangeOps.push({start:e,end:t,diff:r})},getRange:function(e,t){return this.source.substr(this.mapIndex(e),this.mapIndex(t))},toString:function(){return this.source}},global.Loader=Loader,global.Module=Module,global.System=defaultSystemLoader})(window);